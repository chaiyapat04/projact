<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #d6cdcd; font-family: 'Prompt', sans-serif; padding-bottom: 70px; margin: 0; }
        .header { display: flex; align-items: center; padding: 20px; gap: 15px; }
        .menu-icon { font-size: 24px; color: #333; }
        .search-bar { flex-grow: 1; background: white; border-radius: 30px; padding: 8px 15px; display: flex; align-items: center; }
        .search-bar input { border: none; outline: none; width: 100%; font-size: 16px; margin-left: 10px; }
        .tag-container { text-align: center; margin-bottom: 20px; }
        .tag { background: white; color: #004d40; padding: 5px 40px; border-radius: 20px; font-weight: 600; font-size: 18px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: inline-block; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .card { background: white; border: 1px solid #ddd; padding: 10px; display: flex; flex-direction: column; justify-content: space-between; border-radius: 15px; cursor: pointer; transition: transform 0.2s; position: relative; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .card img { width: 100%; height: 120px; object-fit: contain; margin-bottom: 10px; }
        .info { margin-bottom: 10px; }
        .name { font-size: 14px; font-weight: 600; display: block; margin-bottom: 5px; }
        .price { color: red; font-weight: bold; font-size: 14px; }
        .btn-add-cart { background: #009688; color: white; border: none; width: 100%; padding: 8px; border-radius: 20px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-add-cart:hover { background: #00796b; }
        .navbar { position: fixed; bottom: 0; width: 100%; height: 60px; background: #d6cdcd; border-top: 2px solid #555; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { font-size: 24px; color: #000; cursor: pointer; }
        .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background-color: white; padding: 30px; border-radius: 20px; text-align: center; width: 85%; max-width: 400px; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.3); animation: zoomIn 0.3s; }
        @keyframes zoomIn { from {transform: scale(0.5);} to {transform: scale(1);} }
        .modal-img { width: 150px; height: 150px; object-fit: contain; margin-bottom: 20px; }
        .modal-title { font-size: 22px; font-weight: bold; margin-bottom: 10px; color: #333; }
        .modal-price { font-size: 24px; color: #c62828; font-weight: bold; margin-bottom: 15px; }
        /* สไตล์สำหรับรายละเอียดใน Modal */
        #modalDetails { font-size: 14px; color: #555; line-height: 1.6; margin-bottom: 25px; text-align: left; background: #f9f9f9; padding: 15px; border-radius: 10px; border-left: 4px solid #009688; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 30px; color: #aaa; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header">
        <i class="fa-solid fa-bars menu-icon" onclick="window.history.back()"></i>
        <div class="search-bar">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" value="cpu">
        </div>
    </div>
    
    <div class="tag-container"><div class="tag">CPU</div></div>

    <div class="grid" id="productGrid">
        
    </div>

    <div class="navbar">
    <div class="nav-item" onclick="window.location.href='product_list.html'">
        <i class="fa-solid fa-house"></i>
    </div>
    
    <div class="nav-item" onclick="window.location.href='cart.html'">
        <i class="fa-solid fa-cart-shopping"></i>
    </div>
    
    <div class="nav-item" onclick="window.location.href='admin_add.html'">
        <i class="fa-solid fa-user"></i>
    </div>
</div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <img id="modalImg" class="modal-img" src="">
            <h2 id="modalName" class="modal-title"></h2>
            <div id="modalPrice" class="modal-price"></div>
            <div id="modalDetails"></div> 
            <button class="btn-add-cart" id="modalAddBtn" style="font-size:18px; padding:12px;">ใส่ตะกร้าเลย</button>
        </div>
    </div>
    
    <script>
    // --- ส่วนที่ 1: ดึงสินค้าจาก Admin (LocalStorage) ---
    function renderProducts() {
        const grid = document.getElementById('productGrid');
        const storedProducts = JSON.parse(localStorage.getItem('myShopProducts')) || [];

        storedProducts.forEach(product => {
            if (product.category === 'cpu') { 
                const newCardHTML = `
                    <div class="card" 
                         data-name="${product.name}" 
                         data-price="${product.price}" 
                         data-img="${product.img}" 
                         data-details="${product.details || 'ไม่มีรายละเอียดระบุ'}">
                        <img src="${product.img}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="info">
                            <span class="name">${product.name}</span>
                            <span class="price">${Number(product.price).toLocaleString()}-</span>
                        </div>
                        <button class="btn-add-cart">
                            <i class="fa-solid fa-cart-plus"></i> เพิ่มลงตะกร้า
                        </button>
                    </div>
                `;
                grid.innerHTML += newCardHTML;
            }
        });
        setupEventListeners();
    }

    // --- ส่วนที่ 2: จัดการการคลิก ---
    function setupEventListeners() {
        const allCards = document.querySelectorAll('.card');
        allCards.forEach(card => {
            card.onclick = function(e) {
                if(e.target.closest('.btn-add-cart')) {
                    addToCart(this.dataset.name, this.dataset.price, this.dataset.img);
                    return;
                }
                openModal(this.dataset.name, this.dataset.price, this.dataset.img, this.dataset.details);
            };
        });
    }

    function addToCart(name, price, img) {
        const product = { name, price, img, category: 'CPU' };
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        cart.push(product);
        localStorage.setItem('myCart', JSON.stringify(cart));
        if(confirm('✅ เพิ่ม ' + name + ' ลงตะกร้าแล้ว!\nไปที่หน้าตะกร้าสินค้าเลยไหม?')) {
            window.location.href = 'cart.html';
        }
    }

    const modal = document.getElementById('productModal');
    function openModal(name, price, img, details) {
        modal.style.display = 'flex';
        document.getElementById('modalImg').src = img;
        document.getElementById('modalName').innerText = name;
        document.getElementById('modalPrice').innerText = Number(price).toLocaleString() + ' บาท';
        // ใส่รายละเอียดที่ดึงมาจากข้อมูลสินค้าจริงๆ
        document.getElementById('modalDetails').innerText = details; 
        
        document.getElementById('modalAddBtn').onclick = function() {
            addToCart(name, price, img);
            closeModal();
        };
    }

    function closeModal() { modal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == modal) closeModal(); }

    renderProducts();
    </script>
</body>
</html>